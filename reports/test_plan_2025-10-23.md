# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Direct Binance Connection ‚Äî 23.10.2025

**–í—Ä–µ–º—è:** –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è reconnect –ª–æ–≥–∏–∫–∏  
**Commit:** 7f2ad95

---

## ‚úÖ –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### –ü—Ä–æ–±–ª–µ–º–∞
```
WebSocket connection to 'wss://fstream.binance.com/...' failed: 
WebSocket is closed before the connection is established.
```

–ü–æ—Å–ª–µ unmount React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –≤—ã–∑—ã–≤–∞–ª—Å—è `disconnect()`, –Ω–æ –∑–∞—Ç–µ–º —Å—Ä–∞–±–∞—Ç—ã–≤–∞–ª –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π `reconnect()`.

### –†–µ—à–µ–Ω–∏–µ
1. **–î–≤–æ–π–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ `isManualClose`:**
   ```typescript
   private scheduleReconnect() {
     if (this.reconnectTimer || this.isManualClose) return  // ‚Üê –ø—Ä–æ–≤–µ—Ä–∫–∞ #1
     
     this.reconnectTimer = window.setTimeout(() => {
       if (!this.isManualClose) {  // ‚Üê –ø—Ä–æ–≤–µ—Ä–∫–∞ #2
         this.connect()
       }
     }, this.reconnectDelayMs)
   }
   ```

2. **–ó–∞–∫—Ä—ã—Ç–∏–µ —Å—Ç–∞—Ä–æ–≥–æ WS –ø–µ—Ä–µ–¥ –Ω–æ–≤—ã–º:**
   ```typescript
   connect() {
     // –ó–∞–∫—Ä—ã—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –µ—Å–ª–∏ –µ—Å—Ç—å
     if (this.ws) {
       this.ws.close()
       this.ws = null
     }
     
     this.ws = new WebSocket(url)
     // ...
   }
   ```

---

## üß™ –¢–µ—Å—Ç-–ø–ª–∞–Ω

### 1. –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
```bash
cd /Users/dmitrijnazarov/Projects/Binance_Dashboard/frontend
npm run dev
```

**–û—Ç–∫—Ä—ã—Ç—å:** http://localhost:5173  
**–û–∂–∏–¥–∞–µ—Ç—Å—è –≤ Console:**
```
[Binance WS] Connected: btcusdt@bookTicker/ethusdt@bookTicker/solusdt@bookTicker/bnbusdt@bookTicker
[useBinanceDirect] Connected
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ü–µ–Ω
- **TickerBar:** —Ü–µ–Ω—ã BTC, ETH, SOL, BNB –¥–æ–ª–∂–Ω—ã –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è (<1 —Å–µ–∫)
- **–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä üü¢ Live:** –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–µ–ª—ë–Ω—ã–º –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ reconnect
```javascript
// –í Console:
// –ü–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ WebSocket
const ws = window.performance.getEntriesByType('resource')
  .filter(r => r.name.includes('fstream.binance.com'))[0]

// –ò–º–∏—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä—ã–≤ (–∑–∞–∫—Ä—ã—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ)
// –ß–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã –¥–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è –ª–æ–≥:
// [Binance WS] Reconnecting...
// [Binance WS] Connected: ...
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ unmount (–±–µ–∑ –æ—à–∏–±–æ–∫)
- –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É (F5)
- –í Console –ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—à–∏–±–æ–∫:
  - ‚ùå "WebSocket is closed before the connection is established"
  - ‚úÖ "[Binance WS] Disconnected" (–æ–¥–∏–Ω —Ä–∞–∑)
  - ‚úÖ "[Binance WS] Connected: ..." (–Ω–æ–≤–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ)

### 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ ticker data
- –ü–æ–¥–æ–∂–¥–∞—Ç—å 5-10 —Å–µ–∫—É–Ω–¥
- –í Console –¥–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è –∑–∞–ø—Ä–æ—Å:
  ```
  GET https://fapi.binance.com/fapi/v1/ticker/24hr
  Status: 200
  ```
- –í TickerBar –¥–æ–ª–∂–Ω—ã –æ–±–Ω–æ–≤–∏—Ç—å—Å—è –ø—Ä–æ—Ü–µ–Ω—Ç—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, "+2.34%")

---

## üìä –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### ‚úÖ PASS –∫—Ä–∏—Ç–µ—Ä–∏–∏
- [x] WebSocket –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ (<2 —Å–µ–∫)
- [x] –¶–µ–Ω—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –≤ TickerBar
- [x] –ù–µ—Ç –æ—à–∏–±–æ–∫ "WebSocket is closed before..." –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ
- [x] Reconnect —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∏ –æ–±—Ä—ã–≤–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- [x] Ticker 24h –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è (–∫–∞–∂–¥—ã–µ 5 —Å–µ–∫)

### ‚ö†Ô∏è Known Limitations
- Account balance: –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç $0 (–Ω–µ—Ç –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö)
- Positions: —Ç–∞–±–ª–∏—Ü–∞ –ø—É—Å—Ç–∞—è
- Trades: —Å–ø–∏—Å–æ–∫ –ø—É—Å—Ç–æ–π
- Equity chart: –Ω–µ—Ç —Ç–æ—á–µ–∫ (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å live-–¥–∞–Ω–Ω—ã—Ö)

---

## üêõ –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞: CORS error
```
Access to XMLHttpRequest at 'https://fapi.binance.com/...' 
from origin 'http://localhost:5173' has been blocked by CORS policy
```

**–†–µ—à–µ–Ω–∏–µ:** REST API Binance —Ä–∞–∑—Ä–µ—à–∞–µ—Ç CORS –¥–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤, –Ω–æ –µ—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Vite proxy:
```typescript
// vite.config.ts
export default defineConfig({
  server: {
    proxy: {
      '/fapi': {
        target: 'https://fapi.binance.com',
        changeOrigin: true,
        rewrite: (path) => path.replace(/^\/fapi/, '')
      }
    }
  }
})
```

### –ü—Ä–æ–±–ª–µ–º–∞: Rate limit
```
HTTP 429 Too Many Requests
```

**–†–µ—à–µ–Ω–∏–µ:** —É–≤–µ–ª–∏—á–∏—Ç—å `tickerRefreshMs` –≤ `App.tsx`:
```typescript
useBinanceDirect({ 
  symbols: TRACKED_SYMBOLS,
  tickerRefreshMs: 10000  // 10 —Å–µ–∫ –≤–º–µ—Å—Ç–æ 5
})
```

### –ü—Ä–æ–±–ª–µ–º–∞: WebSocket disconnect loop
```
[Binance WS] Disconnected
[Binance WS] Reconnecting...
[Binance WS] Disconnected
...
```

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:** –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ, —Å—Ç–∞—Ç—É—Å Binance API:
- https://www.binance.com/en/support/announcement/system-status
- `ping fstream.binance.com`

---

## üìù Checklist –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

- [ ] `npm run dev` –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] –ë—Ä–∞—É–∑–µ—Ä –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –Ω–∞ http://localhost:5173
- [ ] –í Console –ø–æ—è–≤–ª—è–µ—Ç—Å—è "[Binance WS] Connected"
- [ ] TickerBar –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ü–µ–Ω—ã (BTC, ETH, SOL, BNB)
- [ ] –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä üü¢ Live –∑–µ–ª—ë–Ω—ã–π
- [ ] Ticker 24h –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è (–∏–∑–º–µ–Ω–µ–Ω–∏–µ %, –æ–±—ä—ë–º)
- [ ] –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (F5) –±–µ–∑ –æ—à–∏–±–æ–∫ –≤ Console
- [ ] Reconnect —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∏ –æ–±—Ä—ã–≤–µ (—Å–∏–º—É–ª—è—Ü–∏—è)

---

## üéØ Next Steps

–ï—Å–ª–∏ –≤—Å–µ —Ç–µ—Å—Ç—ã PASS:
1. ‚úÖ –ü—É–±–ª–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ä–∞–±–æ—Ç–∞—é—Ç
2. ‚è© –ü–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –∫ Signing Service –¥–ª—è –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
3. ‚è© –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å User Data Stream –¥–ª—è account/positions/trades

–ï—Å–ª–∏ —Ç–µ—Å—Ç—ã FAIL:
1. üîç –ê–Ω–∞–ª–∏–∑ –æ—à–∏–±–æ–∫ –≤ DevTools Console
2. üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ Network tab (XHR/WS –∑–∞–ø—Ä–æ—Å—ã)
3. üîô –ü—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º–∞—Ö ‚Äî –æ—Ç–∫–∞—Ç –Ω–∞ —Å—Ç–∞—Ä—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É (backend)
